{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-hdd-stack me-2"></i>VPS Servers</h2>
    <a href="/add-vps" class="btn btn-primary">
        <i class="bi bi-plus-circle me-1"></i>Add VPS
    </a>
</div>

{% if servers %}
<div class="row">
    {% for server in servers %}
    <div class="col-md-6 col-lg-4 mb-4">
        <div class="card server-card h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">{{ server.name }}</h5>
                <span class="badge {{ 'bg-success' if server.is_active else 'bg-danger' }}">
                    {{ 'Active' if server.is_active else 'Inactive' }}
                </span>
            </div>
            <div class="card-body">
                <p class="mb-2">
                    <i class="bi bi-globe me-2"></i>
                    <strong>IP:</strong> {{ server.ip_address }}
                </p>
                <p class="mb-2">
                    <i class="bi bi-person me-2"></i>
                    <strong>User:</strong> {{ server.ssh_user }}
                </p>
                <p class="mb-2">
                    <i class="bi bi-ethernet me-2"></i>
                    <strong>Port:</strong> {{ server.ssh_port }}
                </p>
                <p class="mb-0 text-muted small">
                    <i class="bi bi-clock me-1"></i>
                    Last checked: {{ server.last_checked.strftime('%Y-%m-%d %H:%M') if server.last_checked else 'Never' }}
                </p>
            </div>
            <div class="card-footer bg-transparent border-0">
                <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-outline-light" onclick="checkStatus({{ server.id }})" id="check-btn-{{ server.id }}">
                        <i class="bi bi-arrow-repeat me-1"></i>Check
                    </button>
                    {% if server.is_active %}
                    <a href="/vps/{{ server.id }}" class="btn btn-sm btn-success">
                        <i class="bi bi-box-arrow-in-right me-1"></i>Enter
                    </a>
                    {% else %}
                    <button class="btn btn-sm btn-secondary" disabled>
                        <i class="bi bi-x-circle me-1"></i>Offline
                    </button>
                    {% endif %}
                    <form action="/delete-vps/{{ server.id }}" method="POST" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this VPS?');">
                        <button type="submit" class="btn btn-sm btn-outline-danger">
                            <i class="bi bi-trash"></i>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="card">
    <div class="card-body text-center py-5">
        <i class="bi bi-server" style="font-size: 4rem; color: #0f3460;"></i>
        <h4 class="mt-3">No VPS Servers Added</h4>
        <p class="text-muted">Add your first VPS server to get started.</p>
        <a href="/add-vps" class="btn btn-primary">
            <i class="bi bi-plus-circle me-1"></i>Add VPS
        </a>
    </div>
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
function checkStatus(serverId) {
    const btn = document.getElementById('check-btn-' + serverId);
    const originalHtml = btn.innerHTML;
    btn.innerHTML = '<span class="spinner-border spinner-border-sm me-1"></span>Checking...';
    btn.disabled = true;
    
    fetch('/check-status/' + serverId)
        .then(response => response.json())
        .then(data => {
            btn.innerHTML = originalHtml;
            btn.disabled = false;
            
            if (data.active) {
                location.reload();
            } else {
                alert('Server is offline: ' + data.message);
                location.reload();
            }
        })
        .catch(error => {
            btn.innerHTML = originalHtml;
            btn.disabled = false;
            alert('Error checking status');
        });
}
</script>
{% endblock %}
